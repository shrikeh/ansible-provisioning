{# This is a workaround so that we get the jails correctly indented -#}
{% set max_key_length = [] -%}
{% for config in fail2ban_jails|map(attribute='config') -%}
  {% for key, val in config.iteritems() -%}
    {% if max_key_length.append(key | length) %}{% endif %}
  {% endfor %}
{% endfor %}
{% set max_key_length = max_key_length | max %}

{% for jail in fail2ban_jails -%}
[{{ jail.name }}]
{% for key, value in jail.config.iteritems() -%}
{{ key.ljust(max_key_length) }} = {{ value | string | indent(max_key_length + 3) }}
{% endfor %}

{% endfor %}
